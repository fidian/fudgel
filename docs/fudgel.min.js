const t=[{},{}],e=(e,n)=>t["*"===e.charAt(0)?0:1][e]=n,n=()=>{const t=new WeakMap;return(e,n)=>t.get(e)||n&&t.set(e,n).get(e)},o=n(),s=n(),c=new Map,r=n(),l=n(),i=n(),a=n(),f=n(),p=n(),u=(t,e,...n)=>{const o=r(e);if(o)for(const s of o[t]||[])o[t].includes(s)&&s(e,...n)},d=t=>{const e=[t];let n;for(;n=e.shift();){for(const t of i(n,[]))t();for(const t of n.childNodes)e.push(t)}},h=(t,e,n,o)=>{const s=r(t,{});s[n]?s[n].push(o):s[n]=[o];i(e,[]).push((()=>{const e=r(t);e&&e[n]&&(e[n]=e[n].filter((t=>t!==o)))}))},g=(t,e,n)=>{const o=a(t,{});let s=o[e];if(!s){let n=t[e];const c=Object.getOwnPropertyDescriptor(t,e)||{};s=[],o[e]=s,Object.defineProperty(t,e,{get:c.get||(()=>n),set:function(t){const e=n;if(t!==e){c.set?c.set(t):n=t;for(const n of s)n(this,t,e)}}})}s.push(n)};function b(t,e,n,o){h(t,e,"set:",n);for(const s of o){const o=`set:${s}`;g(t,s,((t,e,n)=>{u(o,t,e,n),t.onChange&&t.onChange(s,e,n)})),h(t,e,o,n)}}const m=t=>{let e=p(t),n=t.parentNode;for(;!e&&n;)e=p(n),n=n.parentNode;return e||{}},y=(t,e)=>{const n=Object.create(t);return p(e,n),n},$=t=>JSON.stringify(t),v=t=>{const e={};return(...n)=>{const o=$(n);return e[o]||(e[o]=t(...n))}},w=v(((t,e)=>new Function(t,e))),C=t=>w("$scope",`return ${t}`),N=t=>t.replace(/-(\p{Ll})/gu,(t=>t[1].toUpperCase())),M=(t,e,n)=>{!0===n&&(n=""),"string"!=typeof n?t.removeAttribute(e):t.setAttribute(e,`${n}`)},L=v((t=>{const e=t.split(/{{(.*?)}}/);if(e.length<2)return null;const n=[];let o=!1;const s=new Set;for(const t of e){if(o){n.push(C(t));for(const e of O(t))s.add(e)}else n.push(t);o=!o}return{fn:function(t){return n.map((e=>{return e=e&&e.call?e.call(this,t):e,null==(n=e)?"":`${n}`;var n})).join("")},binds:s}})),T=/this\.((?:\$|_|\p{L}|\p{Nl})(?:\$|_|\p{L}|\p{Nl}|\u200C|\u200D|\p{Mn}|\p{Mc}|\p{Nd})*)/u,O=v((t=>{const e=new Set,n=t.split(T);for(let t=1;t<n.length;t+=2)e.add(n[t]);return e})),S=document,x=t=>S.createElement(t),E=t=>{const e=x("style");return e.appendChild((t=>S.createTextNode(t))(t)),e};function j(e,n){if(1===n.nodeType){for(const o of[...n.attributes]){const s=o.nodeName,c=s.charAt(0),r=t[1],l=r[s]||r[c]||r[""];l&&l(e,n,o.nodeValue||"",s)}const o=L(n.textContent||"");if(o){const t=t=>{n.nodeValue=o.fn.call(t,m(n))};b(e,n,t,o.binds),t(e)}}return 1}const k=(e,n,o)=>{const s=o.attributes;if(1===o.nodeType&&s){let r;for(const[e,n]of Object.entries(t[0])){const t=s.getNamedItem(e);if(t){if(r)throw new Error(`${r[0]} breaks ${e}`);r=[e,n,t.nodeValue||""]}}if(r){const t=(c=`${r[0]}=${$(r[2])}`,S.createComment(c));return o.before(t),n.previousNode(),o.remove(),M(o,r[0]),r[1](e,t,o,r[2],r[0]),1}}var c};function A(t,e){if(3===e.nodeType){const n=L(e.textContent||"");if(n){const o=t=>{e.nodeValue=n.fn.call(t,m(e))};return b(t,e,o,n.binds),o(t),1}}}const D=(t,e)=>{const n=S.createTreeWalker(t,133);let o;for(;o=n.nextNode();)"TEMPLATE"===o.nodeName&&D(o.content,e),k(e,n,o)||A(e,o)||j(e,o)},V=(t,e)=>{const n=S.createDocumentFragment();n.append(t),D(n,e)},I=(t,e,n,o={})=>{const s=c.get(t);s&&s.dispatchEvent(new CustomEvent(e,Object.assign({bubbles:!0,cancelable:!1,composed:!0,detail:n},o)))},P=(t,e)=>{if(t)u(`set:${e||""}`,t);else for(const t of c.keys())u("set:",t)},H=(t,e)=>{"function"==typeof t&&(t=t.prototype),f(t,[]).push(e)},F=()=>W,R=(t,e)=>W(t.constructor.prototype,e),W=(t,e)=>H(t,(t=>{h(t,c.get(t),"init",(t=>{const n=e.replace(/\p{Lu}/gu,(t=>`-${t[0]}`.toLowerCase()));const o=c.get(t);if(o){console.log("attr",n,e,o.getAttribute(n));const s=(t,n,o)=>{t[e]=o,t.onChange&&t.onChange(e,n,o)};h(t,o,`attr:${n}`,s),s(t,null,o.getAttribute(n))}g(t,e,((t,e)=>{const o=c.get(t);o&&M(o,n,e)}))}))}));class _ extends HTMLElement{constructor(){super(),p(this,{})}attributeChangedCallback(t,e,n){const o=l(this);u(`attr:${t}`,o,e,n)}connectedCallback(){const t=this.constructor,e=new(s(t));l(this,e),c.set(e,this),(t=>{let e=t.constructor.prototype;for(;e;){for(const n of f(e)||[])n(t);n=e,e=Object.getPrototypeOf(n)}var n})(e);const n=o(t),r=this.shadowRoot||this.attachShadow({mode:"open"});n.style&&r.appendChild(E(n.style)),e.onInit&&e.onInit(),u("init",e);const i=n.template,a=x("template");a.innerHTML=i,D(a.content,e),r.append(a.content),e.onViewInit&&e.onViewInit()}disconnectedCallback(){const t=l(this);d(this),c.delete(t),this.innerHTML="",this.shadowRoot.innerHTML="",t.onDestroy&&t.onDestroy()}}const J=(t,e)=>n=>{q(t,e,n)},U=customElements,q=(t,e,n)=>{const c=class extends _{};o(c,e),s(c,n||class{}),U.get(t)||U.define(t,c)},z=()=>G,B=(t,e)=>G(t.constructor.prototype,e),G=(t,e)=>{H(t,(t=>{h(t,c.get(t),"init",(t=>{const n=c.get(t);if(n){const t=(t,n)=>{l(t)[e]=n};g(n,e,t),t(n,n[e])}}))}))};e("",((t,e,n,o)=>{const s=L(n);if(s){const n=t=>{const n=s.fn.call(t,m(e));M(e,o,n)};b(t,e,n,s.binds),n(t)}})),e("@",((t,e,n,o)=>{const s=N(o.slice(1)),c=m(e),r=w("s,e",`!1===(($scope,$event)=>{${n}})(s,e)&&(e.preventDefault(),e.stopPropagation())`);e.addEventListener(s,(e=>r.call(t,c,e))),M(e,o)})),e("#ref",((t,e,n,o)=>{t[N(n)]=e,M(e,o)})),e(".",((t,e,n,o)=>{const s=C(n),c=N(o.slice(1)),r=m(e),l=t=>{const n=s.call(t,r);e[c]=n};b(t,e,l,O(n)),l(t),M(e,o)})),e("*for",((t,e,n,o)=>{let s="key",c="value";const r=o.match(/^\s*(?:(?:(\S+)\s*,\s*)?(\S+)\s+of\s+)?(\S+)\s*$/);r&&(s=r[1]||s,c=r[2]||c,o=r[3]);const l=C(o),i=m(e);let a=new Map;const f=t=>{const o=l.call(t,i)||[];let r=a;a=new Map;let f=e;const p=()=>o.entries?o.entries():Object.entries(o),u=new Map(r);for(const[t]of p())u.delete(t);for(const t of u.values())d(t),t.remove(),r.delete(t);for(const[e,o]of p()){let l=r.get(e);if(r.delete(e),l!==f.nextSibling){l&&(d(l),l.remove()),l=n.cloneNode(!0);const r=y(i,l);r[s]=e,r[c]=o,V(l,t),f.after(l)}else{y(i,l)[c]=o}f=l,a.set(e,f)}for(const t of r.values())d(t),t.remove()};b(t,e,f,O(o)),f(t)})),e("*if",((t,e,n,o)=>{const s=C(o),c=m(e);let r=null;const l=t=>{s.call(t,c)?r||(r=n.cloneNode(!0),V(r,t),e.after(r)):r&&(d(r),r.remove(),r=null)};b(t,e,l,O(o)),l(t)})),e("*repeat",((t,e,n,o)=>{let s="index";const c=o.match(/^(\S+)\s+as\s+(\S+)$/);c&&(o=c[1],s=c[2]);const r=C(o),l=m(e);let i=[];const a=t=>{let o=+r.call(t,l);for(;i.length>o;){const t=i.pop();d(t),t.remove()}let c=i.length+1,a=i[c-1]||e;for(;i.length<o;){let e=n.cloneNode(!0);y(l,e)[s]=c++,V(e,t),i.push(e),a.after(e),a=e}};b(t,e,a,O(o)),a(t)}));export{F as Attr,J as Component,_ as CustomElement,z as Prop,e as addDirective,R as attr,q as component,I as emit,O as findBindings,c as metadataControllerElement,L as parseText,B as prop,P as update};