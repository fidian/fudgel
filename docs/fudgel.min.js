const t=()=>{const t=new WeakMap;return(e,n)=>t.get(e)||n&&t.set(e,n).get(e)},e=t(),n=t(),o=new Map,s=t(),c=t(),r=t(),i=t(),a=t(),l=t(),h=(t,e,...n)=>{const o=s(e);if(o)for(const s of o[t]||[])o[t].includes(s)&&s(e,...n)},p=t=>{const e=[t];let n;for(;n=e.shift();){for(const t of r(n,[]))t();for(const t of n.childNodes)e.push(t)}},u=(t,e,n,o)=>{const c=s(t,{});c[n]?c[n].push(o):c[n]=[o];r(e,[]).push((()=>{const e=s(t);e&&e[n]&&(e[n]=e[n].filter((t=>t!==o)))}))},d=(t,e,n,o={})=>{t.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!1,composed:!0,detail:n,...o}))},f=(t,e,n,s={})=>{const c=o.get(t);c&&d(c,e,n,s)},m=(t,e)=>{if(t)h(`set:${e||""}`,t);else for(const t of o.keys())h("set:",t)},g=t=>t.entries?t.entries():Object.entries(t),b=t=>JSON.stringify(t),w=t=>{const e={};return(...n)=>{const o=b(n);return e[o]||(e[o]=t(...n))}},y=w(((t,e)=>new Function(t,e))),$=t=>y("$scope",`return ${t}`),v=t=>t.replace(/-(\p{Ll})/gu,(t=>t[1].toUpperCase())),C=t=>t.replace(/\p{Lu}/gu,(t=>`-${t[0]}`.toLowerCase())),L=t=>null==t?"":`${t}`,M=t=>"string"==typeof t,E=(t,e)=>t.getAttribute(e),S=t=>{const e=o.get(t);return e?e.shadowRoot||e:null},T=(t,e,n)=>{!0===n&&(n=""),M(n)?t.setAttribute(e,n):t.removeAttribute(e)},N=document,k=window,x=t=>t.cloneNode(!0),A=t=>N.createElement(t),j=()=>N.createDocumentFragment(),P=t=>{const e=A("style");return e.appendChild((t=>N.createTextNode(t))(t)),e},H=()=>A("template"),O=(t,e)=>N.createTreeWalker(t,e),D=t=>{const e=N.implementation.createHTMLDocument(""),n=e.createElement("style");return n.textContent=t,e.body.appendChild(n),n.sheet.cssRules},R=(t,e,n)=>{const o=i(t,{});let s=o[e];if(!s){let n=t[e];const c=Object.getOwnPropertyDescriptor(t,e)||{};s=[],o[e]=s,Object.defineProperty(t,e,{get:c.get||(()=>n),set:function(t){const e=n;if(t!==e){c.set?c.set(t):n=t;for(const n of s)n(this,t,e)}}})}s.push(n)};function I(t,e,n,o){u(t,e,"set:",n);for(const s of o){const o=`set:${s}`;R(t,s,((t,e,n)=>{h(o,t,e,n),t.onChange&&t.onChange(s,e,n)})),u(t,e,o,n)}}const K=t=>{let e=l(t),n=t.parentNode;for(;!e&&n;)e=l(n),n=n.parentNode;return e||(e={},l(N.body,e)),e},V=(t,e)=>{const n=Object.create(t);return l(e,n),n},_=w(((t,e=!1)=>{const n=t.split(/{{(.*?)}}/);if(n.length<2)return null;const o=[];let s=!1;const c=new Set;for(const t of n){if(s){o.push($(t));for(const e of F(t))c.add(e)}else o.push(t);s=!s}return 3===o.length&&""===o[0]&&""===o[2]&&e?{fn:function(t){const e=o[1].call(this,t);return"boolean"==typeof e?e:L(e)},binds:c}:{fn:function(t){return o.map((e=>(e=e&&e.call?e.call(this,t):e,L(e)))).join("")},binds:c}})),G=/this\.((?:\$|_|\p{L}|\p{Nl})(?:\$|_|\p{L}|\p{Nl}|\u200C|\u200D|\p{Mn}|\p{Mc}|\p{Nd})*)/u,F=w((t=>{const e=new Set,n=t.split(G);for(let t=1;t<n.length;t+=2)e.add(n[t]);return e})),W={window:()=>{},document:()=>{},stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:(t,e)=>t.target!==e,outside:(t,e)=>e.contains(t.target),ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>0!==t.button,middle:t=>1!==t.button,right:t=>2!==t.button,exact:(t,e,n)=>["ctrl","shift","alt","meta"].some((e=>t[`${e}Key`]&&!n.has(e)))},J=[{"*for":(t,e,n,o)=>{let s="key",c="value";const r=o.match(/^\s*(?:(?:(\S+)\s*,\s*)?(\S+)\s+of\s+)?(\S+)\s*$/);r&&(s=r[1]||s,c=r[2]||c,o=r[3]);const i=$(o),a=K(e);let l=new Map;const h=t=>{const o=i.call(t,a)||[];let r=l;l=new Map;let h=e;const u=new Map(r);for(const[t]of g(o))u.delete(t);for(const t of u.values())p(t),t.remove(),r.delete(t);for(const[e,i]of g(o)){let o=r.get(e);if(r.delete(e),o!==h.nextSibling){o&&(p(o),o.remove()),o=x(n);const r=V(a,o);r[s]=e,r[c]=i,X(o,t),h.after(o)}else{V(a,o)[c]=i}h=o,l.set(e,h)}for(const t of r.values())p(t),t.remove()};I(t,e,h,F(o)),h(t)},"*if":(t,e,n,o)=>{const s=$(o),c=K(e);let r=null;const i=t=>{s.call(t,c)?r||(r=x(n),V(c,r),X(r,t),e.after(r)):r&&(p(r),r.remove(),r=null)};I(t,e,i,F(o)),i(t)},"*repeat":(t,e,n,o)=>{let s="index";const c=o.match(/^(\S+)\s+as\s+(\S+)$/);c&&(o=c[1],s=c[2]);const r=$(o),i=K(e);let a=[];const l=t=>{let o=+r.call(t,i);for(;a.length>o;){const t=a.pop();p(t),t.remove()}let c=a.length+1,l=a[c-1]||e;for(;a.length<o;){let e=x(n);V(i,e)[s]=c++,X(e,t),a.push(e),l.after(e),l=e}};I(t,e,l,F(o)),l(t)}},{"":(t,e,n,o)=>{const s=_(n,!0);if(s){const n=t=>{T(e,o,s.fn.call(t,K(e)))};I(t,e,n,s.binds),n(t)}},"@":(t,e,n,o)=>{const[s,...c]=v(o.slice(1)).split("."),r=K(e),i=y("s,e",`(($scope,$event)=>{${n}})(s,e)`),a={},l=new Set(c);let h=e;for(const t of["passive","capture","once"])l.has(t)&&(a[t]=!0);l.has("window")&&(h=k),(l.has("document")||l.has("outside"))&&(h=N),h.addEventListener(s,(n=>{c.some((t=>(W[t]||(e=>{return n=e.key,C(n.replace(/^\p{Lu}/gu,(t=>t.toLowerCase())))!==(t.match(/^code-\d+$/)?String.fromCodePoint(+t.split("-")[1]):t);var n}))(n,e,l)))||i.call(t,r,n)}),a),T(e,o)},"#ref":(t,e,n,o)=>{t[v(n)]=e,T(e,o)},".":(t,e,n,o)=>{const s=$(n),c=v(o.slice(1)),r=K(e),i=t=>{const n=s.call(t,r);e[c]=n};I(t,e,i,F(n)),i(t),T(e,o)}}],U=(t,e)=>J["*"===t.charAt(0)?0:1][t]=e;function q(t,e){if(1===e.nodeType)for(const n of[...e.attributes]){const o=n.nodeName,s=o.charAt(0),c=J[1],r=c[o]||c[s]||c[""];r&&r(t,e,n.nodeValue||"",o)}return 1}const z=(t,e,n)=>{const o=n.attributes;if(1===n.nodeType&&o){let c;for(const[t,e]of g(J[0])){const n=o.getNamedItem(t);if(n){if(c)throw new Error(`${c[0]} breaks ${t}`);c=[t,e,n.nodeValue||""]}}if(c){const o=(s=`${c[0]}=${b(c[2])}`,N.createComment(s));return n.before(o),e.previousNode(),n.remove(),T(n,c[0]),c[1](t,o,n,c[2],c[0]),1}}var s};function B(t,e){if(3===e.nodeType){const n=_(e.textContent||"");if(n){const o=t=>{e.nodeValue=n.fn.call(t,K(e))};return I(t,e,o,n.binds),o(t),1}}}const Q=(t,e)=>{const n=O(t,133);let o;for(;o=n.nextNode();)"TEMPLATE"===o.nodeName&&Q(o.content,e),z(e,n,o)||B(e,o)||q(e,o)},X=(t,e)=>{const n=j();n.append(t),Q(n,e)};class Y extends HTMLElement{constructor(){super()}attributeChangedCallback(t,e,n){const o=v(t),s=c(this);s&&this.#t(s,o,n)}connectedCallback(){const t=this.constructor,s=new(n(t));c(this,s),o.set(s,this),(t=>{let e=t.constructor.prototype;for(;e;){for(const n of a(e)||[])n(t);n=e,e=Object.getPrototypeOf(n)}var n})(s);const r=e(t),i=r.useShadow?this.shadowRoot||this.attachShadow({mode:"open"}):this;this.classList.add(r.className),r.style&&i.appendChild(P(r.style)),this.#e(r,s),s.onInit&&s.onInit(),h("init",s);const l=r.template,p=H();p.innerHTML=l,Q(p.content,s),i.append(p.content),s.onViewInit&&s.onViewInit()}disconnectedCallback(){const t=c(this);t&&t.onDestroy&&t.onDestroy(),p(this),o.delete(t),this.innerHTML="",this.shadowRoot&&(this.shadowRoot.innerHTML="")}#e(t,e){for(const n of t.prop||[]){const t=(t,e)=>{const o=c(t);this.#t(o,n,e)};R(this,n,t),t(this,this[n]);const s=(t,e)=>{const s=o.get(t);s&&(s[n]=e)};R(e,n,s),s(e,e[n])}for(const n of t.attr||[]){const s=C(n);if(this.#t(e,n,E(this,s)),!(t.prop||[]).includes(n)){R(e,n,((t,e)=>{const n=o.get(t);n&&T(n,s,e)}))}}}#t(t,e,n){const o=t[e];t[e]=n,t.onChange&&t.onChange(e,o,n)}}let Z=new Map,tt=()=>{var t;Z=k[t="__fudgel"]||(k[t]=Z),tt=()=>{}};const et=(t,e)=>n=>{st(t,e,n)},nt=customElements;let ot=()=>{const t=D("@scope{}").length>0;return ot=()=>t,t};const st=(t,o,s)=>{tt();const c=`fudgel-${(()=>{const t=Z.get("n")||0;return Z.set("n",t+1),t})()}`,r=rt(o.style||"",t,c,ot(),o.useShadow),i={...o,className:c,style:r},a=class extends Y{static observedAttributes=(i.attr||[]).map(C)};e(a,i),n(a,s||class{});const l=H();l.innerHTML=i.template,ct(l,c),i.template=l.innerHTML,nt.get(t)||nt.define(t,a)},ct=(t,e)=>{const n=O(t.content,1);let o;for(;o=n.nextNode();)"TEMPLATE"===o.nodeName&&ct(o,e),o.classList.add(e)},rt=(t,e,n,o,s)=>{const c=t=>{t[it]&&(t[it]=t[it].split(",").map((t=>r(t))).join(","),e="");for(const e of t.cssRules)c(e);return`${o?"@scope{":""}${t.cssText}${o?"}":""}`},r=t=>{const c=t=>`${t}.${n}`,r=(t,e)=>t.replace(/:scope/,e),i=r(t=t.trim(),"")===t;return o?i&&(t=c(t)):s?(t=r(t,":host"),(i||t.includes(" "))&&(t=c(t))):(t=r(t,e),i&&(t=`${e} ${c(t)}`)),t};return[...D(t)].map((t=>c(t))).join("")},it="selectorText",at=new Map,lt=[],ht=t=>{if(lt.includes(t))throw lt.push(t),new Error(`Circular dependency: ${lt.map((t=>`${t.name}`)).join(" -> ")}`);lt.push(t);const e=at.get(t)||at.set(t,new t).get(t);return lt.pop(),e},pt=(t,e)=>{at.set(t,e)};class ut{#n=new Map;emit=(t,...e)=>{for(const n of[...this.#o(t)])n(...e)};off=(t,e)=>{const n=this.#o(t);for(let t=n.length-1;t>=0;t-=1)n[t]===e&&n.splice(t,1)};on=(t,e)=>this.#o(t).push(e)&&(()=>this.off(t,e));#o=t=>this.#n.get(t)||this.#n.set(t,[]).get(t)}class dt extends HTMLElement{#s=j();#c=[];#r=[];#i=[];constructor(){super();let t=this.children,e=t[0];if("TEMPLATE"===e.nodeName)this.#r=Array.from(e.content.children);else for(;t.length>0;){const e=t[0];this.#r.push(e),this.#s.appendChild(e)}}connectedCallback(){this.#a(k,"popstate",this.#l),this.#a(N.body,"click",this.#h),this.#p(k.location.pathname),this.#u(k.history,"pushState",this.#d),this.#u(k.history,"replaceState",this.#d)}disconnectedCallback(){for(;this.#i.length;)this.#i.pop()()}go(t){k.history.pushState(null,"",t)}#f(t){let e=!1;if(t.e!==this.#c[0]){const n=E(t.e,"title"),o=E(t.e,"component");this.innerHTML="",n&&(N.title=n),this.#c=[t.e,o?A(o):x(t.e)],e=!0}const n=this.#c[1];for(const[e,o]of t.g)T(n,C(e),o);e&&this.appendChild(n)}#h(t){if(!t.defaultPrevented){const e=t.composedPath().filter((t=>"A"===t.tagName))[0];e&&e.href&&e.origin===k.location.origin&&(t.preventDefault(),this.go(`${e.pathname}${e.search}${e.hash}`))}}#a(t,e,n){const o=n.bind(this);t.addEventListener(e,o),this.#i.push((()=>t.removeEventListener(e,o)))}#m(t){for(const e of this.#r){const n=E(e,"path")||"**",o=E(e,"regexp");let s=n;M(o)||(s=n.replace(/\*+/g,(t=>t.length>1?".*":"[^/]*")).replace(/:[^:\/]+/g,(t=>`(?<${t.slice(1)}>[^/]+)`)));const c=new RegExp(`^${s}(/.*)?$`),r=t.match(c);if(r)return{e,g:Object.entries(r.groups||{})}}return null}#d(t,e){return(n,o,s)=>{e.call(t,n,o,s),this.#p(s||"/")}}#u(t,e,n){const o=t[e];t[e]=n.call(this,t,o),this.#i.push((()=>t[e]=o))}#l(){this.#p(k.location.pathname)}#p(t){const e=this.#m(t);e&&this.#f(e),d(N.body,"routeChange",t)}}const ft=(t="router-outlet")=>{customElements.define(t,dt)},mt=(t,...e)=>String.raw({raw:t},...e),gt=mt;export{et as Component,Y as CustomElement,ut as Emitter,dt as RouterComponent,U as addDirective,st as component,gt as css,ft as defineRouterComponent,ht as di,pt as diOverride,d as dispatchCustomEvent,f as emit,F as findBindings,E as getAttribute,mt as html,o as metadataControllerElement,_ as parseText,S as rootElement,T as setAttribute,m as update};