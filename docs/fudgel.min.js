const t=()=>{const t=new WeakMap;return(e,n)=>t.get(e)||n&&t.set(e,n).get(e)},e=t(),n=t(),o=new Map,s=t(),r=t(),c=t(),i=t(),a=t(),l=t(),h=(t,e,...n)=>{const o=s(e);if(o)for(const s of o[t]||[])o[t].includes(s)&&s(e,...n)},f=t=>{const e=[t];let n;for(;n=e.shift();){for(const t of i(n,[]))t();for(const t of n.childNodes)e.push(t)}},u=(t,e,n,o)=>{const r=s(t,{});r[n]?r[n].push(o):r[n]=[o];i(e,[]).push((()=>{const e=s(t);e&&e[n]&&(e[n]=e[n].filter((t=>t!==o)))}))},p=(t,e,n,o={})=>{t.dispatchEvent(new CustomEvent(e,{bubbles:!0,cancelable:!1,composed:!0,detail:n,...o}))},d=(t,e,n,s={})=>{const r=o.get(t);r&&p(r,e,n,s)},m=(t,e)=>{if(t)g(t,e);else for(const t of o.keys())g(t)},g=(t,n)=>{const s=o.get(t),r=e(s.constructor);if(t.onChange)for(const e of[...r.prop||[],...r.attr||[]])t.onChange(e,t[e],t[e]);h(`set:${n||""}`,t)},b=t=>t.entries?t.entries():Object.entries(t),v=t=>{const e=new Map;return n=>{if(e.has(n))return e.get(n);const o=t(n);return e.set(n,o),o}},w=t=>t.replace(/-(\p{Ll})/gu,(t=>t[1].toUpperCase())),y=t=>t.replace(/\p{Lu}/gu,(t=>`-${t[0]}`.toLowerCase())),C=t=>null==t?"":`${t}`,$=t=>"string"==typeof t,E=(t,e)=>t.getAttribute(e),M=t=>{const e=o.get(t);return e?e.shadowRoot||e:null},L=(t,e,n)=>{!0===n&&(n=""),$(n)?t.setAttribute(e,n):t.removeAttribute(e)},S=(t,e)=>[...new Set([...t,...e])],T=(t,e)=>"function"==typeof t[e]?t[e].bind(t):t[e],k=document,N=window,x=t=>t.cloneNode(!0),A=t=>k.createElement(t),I=()=>k.createDocumentFragment(),P=t=>{const e=A("style");return e.append((t=>k.createTextNode(t))(t)),e},R=()=>A("template"),j=(t,e)=>k.createTreeWalker(t,e),H=t=>{const e=k.implementation.createHTMLDocument(""),n=e.createElement("style");return n.textContent=t,e.body.append(n),n.sheet.cssRules},O=(t,e,n)=>{const o=a(t,{});let s=o[e];if(!s){let n=t[e];const r=Object.getOwnPropertyDescriptor(t,e)||{};s=[],o[e]=s,Object.defineProperty(t,e,{get:r.get||(()=>n),set:function(t){const e=n;if(t!==e){r.set?r.set(t):n=t;for(const n of s)n(this,t,e)}}})}s.push(n)};function D(t,e,n,o,s){u(t,e,"set:",n);for(const r of o){const o=`set:${r}`;r in s?(O(s,r,((e,n,s)=>{h(o,t,n,s)})),u(s,e,o,n)):(O(t,r,((t,e,n)=>{h(o,t,e,n),t.onChange&&t.onChange(r,e,n)})),u(t,e,o,n))}}const K=t=>{let e=l(t);if(t){let n=t.parentNode;for(;!e&&n;)e=l(n),n=n.parentNode}return e||(e={},l(k.body,e)),e},V=(t,e)=>{const n=Object.create(t);return l(e,n),n},G=(t,e)=>new Proxy(t,{get:(t,n)=>T(n in e?e:t,n)});let F="",W=0,_=0;const q={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v"},J={"-":t=>e=>-t(e),"!":t=>e=>!t(e),"~":t=>e=>~t(e),"+":t=>e=>+t(e)},U={"||":[1,(t,e)=>n=>t(n)||e(n)],"&&":[2,(t,e)=>n=>t(n)&&e(n)],"|":[3,(t,e)=>n=>t(n)|e(n)],"^":[4,(t,e)=>n=>t(n)^e(n)],"&":[5,(t,e)=>n=>t(n)&e(n)],"==":[6,(t,e)=>n=>t(n)==e(n)],"!=":[6,(t,e)=>n=>t(n)!=e(n)],"===":[6,(t,e)=>n=>t(n)===e(n)],"!==":[6,(t,e)=>n=>t(n)!==e(n)],"<":[7,(t,e)=>n=>t(n)<e(n)],">":[7,(t,e)=>n=>t(n)>e(n)],"<=":[7,(t,e)=>n=>t(n)<=e(n)],">=":[7,(t,e)=>n=>t(n)>=e(n)],"<<":[8,(t,e)=>n=>t(n)<<e(n)],">>":[8,(t,e)=>n=>t(n)>>e(n)],">>>":[8,(t,e)=>n=>t(n)>>>e(n)],"+":[9,(t,e)=>n=>t(n)+e(n)],"-":[9,(t,e)=>n=>t(n)-e(n)],"*":[10,(t,e)=>n=>t(n)*e(n)],"/":[10,(t,e)=>n=>t(n)/e(n)],"%":[10,(t,e)=>n=>t(n)%e(n)]},z={true:()=>!0,false:()=>!1,null:()=>null},B=t=>{F=t,W=0,Q(0);let e=[()=>{},[]];try{e=nt()||tt()}catch(t){}return e},Q=(t=1)=>{W+=t,_=F.charCodeAt(W)},X=()=>F.charAt(W),Y=t=>t>=48&&t<=57,Z=t=>t>=65&&t<=90||t>=97&&t<=122||t>=128||36===t||95===t,tt=()=>{const t=`Parse error at index ${W}: ${F}`;throw console.error(t),new Error(t)},et=()=>{for(;32===_||9===_||10===_||13===_;)Q()},nt=()=>{const t=st();return et(),t},ot=()=>{et();let t,e=F.substr(W,3),n=3;for(;n>0;){if(t=U[e],t){Q(n);break}e=e.substr(0,--n)}return t},st=()=>{let t,e,n,o,s,r,c;if(s=rt(),!s)return s;if(e=ot(),!e)return s;for(r=rt()||tt(),o=[s,e,r],c=()=>{let t=o.pop(),e=o.pop(),n=o.pop();o.push([e[1](n[0],t[0]),S(n[1],t[1])])};n=ot();){for(;o.length>2&&n[0]<=o[o.length-2][0];)c();t=rt()||tt(),o.push(n,t)}for(;o.length>1;)c();return o[0]},rt=()=>{let t;if(et(),Y(_)||46===_)return it();if(39===_||34===_)t=at();else{const e=J[X()];if(e){Q();const t=rt()||tt();return[e(t[0]),t[1]]}Z(_)||tt();const n=lt();t=z[n]?[z[n],[]]:[t=>T(t,n),[n]]}return ct(t)},ct=t=>{for(et();46===_||91===_||40===_||63===_;){let e,n,o=[],s=t;if(63===_&&(Q(),et(),46!==_&&tt(),e=!0),91===_){Q();const t=nt()||tt();n=(e,n)=>T(e,t[0](n)),o=t[1],93!==_&&tt(),Q()}else if(40===_){Q();const t=ht();n=(e,n)=>e(...t.map((t=>t[0](n)))),o=t.reduce(((t,e)=>S(t,e[1])),o)}else if(46===_){Q(),et();const t=lt();n=e=>T(e,t)}else tt();t=e?[t=>{const e=s[0](t);return void 0===e?void 0:n(e,t)},S(s[1],o)]:[t=>n(s[0](t),t),S(s[1],o)],et()}return t},it=()=>{let t="";for(;Y(_);)t+=X(),Q();if(46===_)for(t+=".",Q();Y(_);)t+=X(),Q();if(101===_||69===_){t+=X(),Q(),43!==_&&45!==_||(t+=X(),Q());let e=!0;for(;Y(_);)t+=X(),Q(),e=!1;e&&tt()}Z(_)?tt():46!==_&&"."!==t||tt();const e=parseFloat(t);return[()=>e,[]]},at=()=>{let t="";const e=_;for(Q();W<F.length&&_!==e;){if(92===_){Q();const e=X();t+=q[e]||e}else t+=X();Q()}return W>=F.length&&tt(),Q(),[()=>t,[]]},lt=()=>{let t=W;for(Z(_)?Q():tt();W<F.length&&(Z(_)||Y(_));)Q();return F.slice(t,W)},ht=()=>{const t=[];for(et();41!==_;)W>=F.length&&tt(),t.push(nt()||tt()),et(),44===_?(Q(),et()):41!==_&&tt();return Q(),t},ft=t=>{const e=t.split(/{{(.*?)}}/);if(e.length<2)return null;const n=[];let o=!1,s=[];for(const t of e){if(o){const e=B(t);n.push(e[0]),s=S(s,e[1])}else n.push(t);o=!o}return[n,s]},ut=t=>t?[e=>t[0].map((t=>C(t&&t.call?t(e):t))).join(""),t[1]]:null,pt=v((t=>{const e=ft(t);return e&&3===e[0].length&&""===e[0][0]&&""===e[0][2]?[t=>{const n=e[0][1](t);return"boolean"==typeof n?n:C(n)},e[1]]:ut(e)})),dt=v((t=>ut(ft(t)))),mt={window:()=>{},document:()=>{},stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:(t,e)=>t.target!==e,outside:(t,e)=>e.contains(t.target),ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>0!==t.button,middle:t=>1!==t.button,right:t=>2!==t.button,exact:(t,e,n)=>["ctrl","shift","alt","meta"].some((e=>t[`${e}Key`]&&!n.has(e)))},gt=[{"*for":(t,e,n,o)=>{let s="key",r="value";const c=o.match(/^\s*(?:(?:(\S+)\s*,\s*)?(\S+)\s+of\s+)?(\S+)\s*$/);c&&(s=c[1]||s,r=c[2]||r,o=c[3]);const i=B(o),a=K(e);let l=new Map;const h=t=>{const o=i[0](G(t,a))||[];let c=l;l=new Map;let h=e;const u=new Map(c);for(const[t]of b(o))u.delete(t);for(const t of u.values())f(t),t.remove(),c.delete(t);for(const[e,i]of b(o)){let o=c.get(e);if(c.delete(e),o!==h.nextSibling){o&&(f(o),o.remove()),o=x(n);const c=V(a,o);c[s]=e,c[r]=i,$t(o,t),h.after(o)}else{V(a,o)[r]=i}h=o,l.set(e,h)}for(const t of c.values())f(t),t.remove()};D(t,e,h,i[1],a),h(t)},"*if":(t,e,n,o)=>{const s=B(o),r=K(e);let c=null;const i=t=>{s[0](G(t,r))?c||(c=x(n),V(r,c),$t(c,t),e.after(c)):c&&(f(c),c.remove(),c=null)};D(t,e,i,s[1],r),i(t)},"*repeat":(t,e,n,o)=>{let s="index";const r=o.match(/^(\S+)\s+as\s+(\S+)$/);r&&(o=r[1],s=r[2]);const c=B(o),i=K(e);let a=[];const l=t=>{let o=+c[0](G(t,i));for(;a.length>o;){const t=a.pop();f(t),t.remove()}let r=a.length+1,l=a[r-1]||e;for(;a.length<o;){let e=x(n);V(i,e)[s]=r++,$t(e,t),a.push(e),l.after(e),l=e}};D(t,e,l,c[1],i),l(t)}},{"":(t,e,n,o)=>{const s=pt(n);if(s){const n=K(e),r=t=>{L(e,o,s[0](G(t,n)))};D(t,e,r,s[1],n),r(t)}},"@":(t,e,n,o)=>{const[s,...r]=w(o.slice(1)).split("."),c=Object.create(K(e)),i=B(n),a={},l=new Set(r);let h=e;for(const t of["passive","capture","once"])l.has(t)&&(a[t]=!0);l.has("window")&&(h=N),(l.has("document")||l.has("outside"))&&(h=k),h.addEventListener(s,(n=>{r.some((t=>(mt[t]||(e=>{return n=e.key,y(n.replace(/^\p{Lu}/gu,(t=>t.toLowerCase())))!==(t.match(/^code-\d+$/)?String.fromCodePoint(+t.split("-")[1]):t);var n}))(n,e,l)))||(e=>{c.$event=e,i[0](G(t,c))})(n)}),a),L(e,o)},"#ref":(t,e,n,o)=>{t[w(n)]=e,L(e,o)},".":(t,e,n,o)=>{const s=B(n),r=w(o.slice(1)),c=K(e),i=t=>{const n=s[0](G(t,c));e[r]=n};D(t,e,i,s[1],c),i(t),L(e,o)}}],bt=(t,e)=>gt["*"===t.charAt(0)?0:1][t]=e;function vt(t,e){if(1===e.nodeType)for(const n of[...e.attributes]){const o=n.nodeName,s=o.charAt(0),r=gt[1],c=r[o]||r[s]||r[""];c&&c(t,e,n.nodeValue||"",o)}}const wt=(t,e,n)=>{const o=n.attributes;if(1===n.nodeType&&o){let c;for(const[t,e]of b(gt[0])){const n=o.getNamedItem(t);if(n){if(c)throw new Error(`${c[0]} breaks ${t}`);c=[t,e,n.nodeValue||""]}}if(c){const o=(s=`${c[0]}=${r=c[2],JSON.stringify(r)}`,k.createComment(s));return n.before(o),e.previousNode(),n.remove(),L(n,c[0]),c[1](t,o,n,c[2],c[0]),1}}var s,r};function yt(t,e){if(3===e.nodeType){const n=dt(e.textContent||"");if(n){const o=K(e),s=t=>{e.nodeValue=n[0](G(t,o))};return D(t,e,s,n[1],o),s(t),1}}}const Ct=(t,e)=>{const n=j(t,133);let o;for(;o=n.nextNode();)"TEMPLATE"===o.nodeName&&Ct(o.content,e),wt(e,n,o)||yt(e,o)||vt(e,o)},$t=(t,e)=>{const n=I();n.append(t),Ct(n,e)};class Et extends HTMLElement{constructor(){super()}attributeChangedCallback(t,e,n){const o=w(t),s=r(this);s&&this.#t(s,o,n)}connectedCallback(){const t=this.constructor,s=new(n(t)),c=e(t),i=c.useShadow,a=i?this.shadowRoot||this.attachShadow({mode:"open"}):this;r(this,s),o.set(s,this),this.classList.add(c.className),this.#e(c,s),s.onInit&&s.onInit(),h("init",s);const l=R();l.innerHTML=c.template,Ct(l.content,s),i||this.#n(),c.style&&a.append(P(c.style)),a.append(l.content),s.onViewInit&&s.onViewInit()}disconnectedCallback(){const t=r(this);t&&t.onDestroy&&t.onDestroy(),f(this),o.delete(t),this.#n()}#e(t,e){for(const n of t.prop||[]){const t=(t,e)=>{const o=r(t);this.#t(o,n,e)};O(this,n,t),t(this,this[n]);const s=(t,e)=>{const s=o.get(t);s&&(s[n]=e)};O(e,n,s),s(e,e[n])}for(const n of t.attr||[]){const s=y(n);if(this.#t(e,n,E(this,s)),!(t.prop||[]).includes(n)){O(e,n,((t,e)=>{const n=o.get(t);n&&L(n,s,e)}))}}}#t(t,e,n){const o=t[e];t[e]=n,t.onChange&&t.onChange(e,o,n)}#n(){this.innerHTML="",this.shadowRoot&&(this.shadowRoot.innerHTML="")}}let Mt=new Map,Lt=()=>{var t;Mt=N[t="__fudgel"]||(N[t]=Mt),Lt=()=>{}};const St=(t,e)=>n=>{Nt(t,e,n)},Tt=customElements;let kt=()=>{const t=H("@scope{}").length>0;return kt=()=>t,t};const Nt=(t,o,s)=>{Lt();const r=`fudgel-${(()=>{const t=Mt.get("n")||0;return Mt.set("n",t+1),t})()}`,c=At(o.style||"",t,r,kt(),o.useShadow),i={...o,className:r,style:c},a=class extends Et{static observedAttributes=(i.attr||[]).map(y)};e(a,i),n(a,s||class{});const l=R();l.innerHTML=i.template,xt(l,r),i.template=l.innerHTML,Tt.get(t)||Tt.define(t,a)},xt=(t,e)=>{const n=j(t.content,1);let o;for(;o=n.nextNode();)"TEMPLATE"===o.nodeName&&xt(o,e),o.classList.add(e)},At=(t,e,n,o,s)=>{const r=t=>{t[It]&&(t[It]=t[It].split(",").map((t=>c(t))).join(","),e="");for(const e of t.cssRules)r(e);return`${o?"@scope{":""}${t.cssText}${o?"}":""}`},c=t=>{const r=t=>`${t}.${n}`,c=(t,e)=>t.replace(/:scope/,e),i=c(t=t.trim(),"")===t;return o?i&&(t=r(t)):s?(t=c(t,":host"),(i||t.includes(" "))&&(t=r(t))):(t=c(t,e),i&&(t=`${e} ${r(t)}`)),t};return[...H(t)].map((t=>r(t))).join("")},It="selectorText",Pt=new Map,Rt=[],jt=t=>{if(Rt.includes(t))throw Rt.push(t),new Error(`Circular dependency: ${Rt.map((t=>`${t.name}`)).join(" -> ")}`);Rt.push(t);const e=Pt.get(t)||Pt.set(t,new t).get(t);return Rt.pop(),e},Ht=(t,e)=>{Pt.set(t,e)};class Ot{#o=new Map;emit=(t,...e)=>{for(const n of[...this.#s(t)])n(...e)};off=(t,e)=>{const n=this.#s(t);for(let t=n.length-1;t>=0;t-=1)n[t]===e&&n.splice(t,1)};on=(t,e)=>this.#s(t).push(e)&&(()=>this.off(t,e));#s=t=>this.#o.get(t)||this.#o.set(t,[]).get(t)}class Dt extends HTMLElement{#r=I();#c=[];#i=[];#a=[];constructor(){super();let t=this.children,e=t[0];if("TEMPLATE"===e.nodeName)this.#i=Array.from(e.content.children);else for(;t.length>0;){const e=t[0];this.#i.push(e),this.#r.append(e)}}connectedCallback(){this.#l(N,"popstate",this.#h),this.#l(k.body,"click",this.#f),this.#u(N.location.pathname),this.#p(N.history,"pushState",this.#d),this.#p(N.history,"replaceState",this.#d)}disconnectedCallback(){for(;this.#a.length;)this.#a.pop()()}go(t){N.history.pushState(null,"",t)}#m(t){let e=!1;if(t.e!==this.#c[0]){const n=E(t.e,"title"),o=E(t.e,"component");this.innerHTML="",n&&(k.title=n),this.#c=[t.e,o?A(o):x(t.e)],e=!0}const n=this.#c[1];for(const[e,o]of t.g)L(n,y(e),o);e&&this.append(n)}#f(t){if(!t.defaultPrevented){const e=t.composedPath().filter((t=>"A"===t.tagName))[0];e&&e.href&&e.origin===N.location.origin&&(t.preventDefault(),this.go(`${e.pathname}${e.search}${e.hash}`))}}#l(t,e,n){const o=n.bind(this);t.addEventListener(e,o),this.#a.push((()=>t.removeEventListener(e,o)))}#g(t){for(const e of this.#i){const n=E(e,"path")||"**",o=E(e,"regexp");let s=n;$(o)||(s=n.replace(/\*+/g,(t=>t.length>1?".*":"[^/]*")).replace(/:[^:\/]+/g,(t=>`(?<${t.slice(1)}>[^/]+)`)));const r=new RegExp(`^${s}(/.*)?$`),c=t.match(r);if(c)return{e,g:Object.entries(c.groups||{})}}return null}#d(t,e){return(n,o,s)=>{e.call(t,n,o,s),this.#u(s||"/")}}#p(t,e,n){const o=t[e];t[e]=n.call(this,t,o),this.#a.push((()=>t[e]=o))}#h(){this.#u(N.location.pathname)}#u(t){const e=this.#g(t);e&&this.#m(e),p(k.body,"routeChange",t)}}const Kt=(t="router-outlet")=>{customElements.define(t,Dt)},Vt=(t,e)=>t.n[e]||(t.n[e]=I()),Gt=t=>t.parentElement||(t.getRootNode()||{}).host,Ft=t=>{const e=M(t);if(e){const n={e:new Ot,n:{"":I()},s:K(Gt(o.get(t)))};for(const t of e.querySelectorAll("[slot]"))Vt(n,E(t,"slot")||"").append(t);for(const t of e.childNodes)n.n[""].append(t);c(e,n)}};class Wt extends HTMLElement{static observedAttributes=["name"];#b;#v;constructor(){super();let t=Gt(this);for(;t&&!(this.#v=c(t));)t=Gt(t)}attributeChangedCallback(t,e,n){const o=this.#v;o&&e!==n&&(this.#w(o,e),this.#y(o))}connectedCallback(){const t=this.#v;t&&(l(this,t.s),this.#y(t))}disconnectedCallback(){this.#v&&this.#w(this.#v,E(this,"name")||"")}#y(t){const e=E(this,"name")||"";this.append(t.n[e]||[]),this.#b=t.e.on(e,(()=>{this.#w(t,e),this.#y(t)}))}#w(t,e){this.#b(),Vt(t,e).append(...this.childNodes),t.e.emit(e)}}const _t=(t="slot-like")=>{customElements.define(t,Wt)},qt=(t,...e)=>String.raw({raw:t},...e),Jt=qt;export{St as Component,Et as CustomElement,Ot as Emitter,bt as addDirective,Nt as component,Jt as css,Kt as defineRouterComponent,_t as defineSlotComponent,jt as di,Ht as diOverride,p as dispatchCustomEvent,d as emit,E as getAttribute,qt as html,o as metadataControllerElement,dt as parseText,pt as parseTextAllowBoolean,M as rootElement,L as setAttribute,Ft as slotInit,m as update,g as updateController};