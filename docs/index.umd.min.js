!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Fudgel={})}(this,(function(t){"use strict";const e=[{},{}],n=(t,n)=>e["*"===t.charAt(0)?0:1][t]=n,o=()=>{const t=new WeakMap;return(e,n)=>t.get(e)||n&&t.set(e,n).get(e)},s=o(),c=o(),r=o(),l=new Map,i=o(),a=o(),f=o(),d=o(),p=o(),u=o(),h=o(),m=o(),g=(t,e,...n)=>{const o=i(e);if(o)for(const s of o[t]||[])o[t].includes(s)&&s(e,...n)},b=t=>{const e=[t];let n;for(;n=e.shift();){for(const t of p(n,[]))t();for(const t of n.childNodes)e.push(t)}},C=(t,e,n,o)=>{const s=i(t,{});s[n]?s[n].push(o):s[n]=[o];p(e,[]).push((()=>{const e=i(t);e&&e[n]&&(e[n]=e[n].filter((t=>t!==o)))}))},y=(t,e,n,o)=>{const s=t(e,{});if(!s[n]){s[n]=1;let t=e[n];const c=Object.getOwnPropertyDescriptor(e,n)||{};Object.defineProperty(e,n,{get:c.get||(()=>t),set:function(e){const n=t;e!==n&&(c.set?c.set(e):t=e,o(this,e,n))}})}};function v(t,e,n,o){C(t,e,"set:",n);for(const s of o){const o=`set:${s}`;y(a,t,s,((t,e,n)=>{g(o,t,e,n),t.onChange&&t.onChange(s,e,n)})),C(t,e,o,n)}}const $=t=>{let e=m(t),n=t.parentNode;for(;!e&&n;)e=m(n),n=n.parentNode;return e||{}},w=(t,e)=>{const n=Object.create(t);return m(e,n),n},N=t=>JSON.stringify(t),x=t=>{const e={};return(...n)=>{const o=N(n);return e[o]||(e[o]=t(...n))}},M=x(((t,e)=>new Function(t,e))),T=t=>M("$scope",`return ${t}`),L=t=>t.replace(/-\p{Ll}/gu,(t=>t[1].toUpperCase())),O=t=>null==t,S=(t,e)=>t.attributes.removeNamedItem(e),j=x(((t,e=!1)=>{const n=t.split(/{{(.*?)}}/);if(n.length<2)return null;if(e&&3===n.length&&""===n[0]&&""===n[2])return{fn:T(t),binds:A(n[1])};const o=[];let s=!1;const c=new Set;for(const t of n){if(s){o.push(T(t));for(const e of A(t))c.add(e)}else o.push(t);s=!s}return{fn:function(t){return o.map((e=>{return e=e&&e.call?e.call(this,t):e,O(n=e)?"":`${n}`;var n})).join("")},binds:c}})),E=/this\.((?:\$|_|\p{L}|\p{Nl})(?:\$|_|\p{L}|\p{Nl}|\u200C|\u200D|\p{Mn}|\p{Mc}|\p{Nd})*)/u,A=x((t=>{const e=new Set,n=t.split(E);for(let t=1;t<n.length;t+=2)e.add(n[t]);return e}));function k(t,n,o,s,c){if(1!==s.nodeType)return!1;for(const t of[...s.childNodes])t.remove(),c.push([s,t]);o?n.appendChild(s):n.after(s);for(const n of[...s.attributes]){const o=n.nodeName,c=o.charAt(0),r=e[1],l=r[o]||r[c]||r[""];l&&l(t,s,n.nodeValue||"",o)}const r=j(s.textContent||"");if(r){const e=t=>{s.nodeValue=r.fn.call(t,$(s))};v(t,s,e,r.binds),e(t)}return!0}const D=document,I=t=>D.createElement(t),V=t=>{const e=I("style");return e.appendChild((t=>D.createTextNode(t))(t)),e},P=(t,n,o)=>{const s=o.attributes;if(1!==o.nodeType||!s)return!1;let c;for(const[t,n]of Object.entries(e[0])){const e=s.getNamedItem(t);if(e){if(c)throw new Error(`${c[0]} breaks ${t}`);c=[t,n,e.nodeValue||""]}}if(!c)return!1;const r=(l=`${c[0]}=${N(c[2])}`,D.createComment(l));var l;n.appendChild(r),S(o,c[0]);const i=o.cloneNode(!0);return c[1](t,r,i,c[2],c[0]),!0};function H(t,e,n){if(3!==n.nodeType)return!1;const o=j(n.textContent||"");if(e.appendChild(n),o){const e=t=>{n.nodeValue=o.fn.call(t,$(n))};v(t,n,e,o.binds),e(t)}return!0}const F=(t,e)=>{for(;t.length;){let[n,o]=t.shift();P(e,n,o)||H(e,n,o)||k(e,n,!0,o,t)||n.appendChild(o)}},R=(t,e)=>{"function"==typeof t&&(t=t.prototype),h(t,[]).push(e)},_=(t,e)=>{const n=e.replace(/\p{Lu}/gu,(t=>`-${t[1]}`.toLowerCase()));const o=l.get(t);o&&C(t,o,`attr:${n}`,((t,n,o)=>{t[e]=o,t.onChange&&t.onChange(e,n,o)}));const c=(t,e)=>{const o=l.get(t);o&&(O(e)?o.removeAttribute(n):o.setAttribute(n,`${e}`))};y(s,t,e,c),c(t,t[e])};class B extends HTMLElement{constructor(){super(),m(this,{})}attributeChangedCallback(t,e,n){const o=d(this);g(`attr:${t}`,o,e,n)}connectedCallback(){const t=this.constructor,e=new(r(t));d(this,e),l.set(e,this),(t=>{let e=t.constructor.prototype;for(;e;){for(const n of h(e)||[])n(t);n=e,e=Object.getPrototypeOf(n)}var n})(e);const n=c(t),o=new DocumentFragment,s=[];for(const t of this.childNodes)s.push([o,t]);F(s,e),this.append(o);const i=this.shadowRoot||this.attachShadow({mode:"open"});n.style&&i.appendChild(V(n.style)),f(e,i),e.onInit&&e.onInit(),g("init",e);const a=n.template,p=[];if(a){const t=I("template");t.innerHTML=a;for(const e of t.content.childNodes)p.push([i,e])}F(p,e),e.onViewInit&&e.onViewInit()}disconnectedCallback(){const t=d(this);b(this),l.delete(t),this.innerHTML="",this.shadowRoot.innerHTML="",t.onDestroy&&t.onDestroy()}}const J=customElements,U=(t,e,n)=>{const o=class extends B{};c(o,e),r(o,n||class{}),J.get(t)||J.define(t,o)},W=(t,e)=>{const n=l.get(t);if(n){const t=(t,n)=>{d(t)[e]=n};y(u,n,e,t),t(n,n[e])}};n("",((t,e,n,o)=>{const s=j(n,!0);if(s){const n=t=>{const n=s.fn.call(t,$(e));"boolean"==typeof n||null==n?n?e.setAttribute(o,""):e.removeAttribute(o):e.setAttribute(o,`${n}`)};v(t,e,n,s.binds),n(t)}})),n("@",((t,e,n,o)=>{const s=L(o.slice(1)),c=$(e),r=M("s,e",`!1===(($scope,$event)=>{${n}})(s,e)&&(e.preventDefault(),e.stopPropagation())`);e.addEventListener(s,(e=>r.call(t,c,e))),S(e,o)})),n("#ref",((t,e,n,o)=>{t[L(n)]=e,S(e,o)})),n(".",((t,e,n,o)=>{const s=T(n),c=L(o.slice(1)),r=$(e),l=t=>{const n=s.call(t,r);e[c]=n};v(t,e,l,A(n)),l(t),S(e,o)})),n("*for",((t,e,n,o)=>{let s="key",c="value";const r=o.match(/^\s*(?:(?:(\S+)\s*,\s*)?(\S+)\s+of\s+)?(\S+)\s*$/);r&&(s=r[1]||s,c=r[2]||c,o=r[3]);const l=T(o),i=$(e);let a=new Map;const f=t=>{const o=l.call(t,i)||[];let r=a;a=new Map;const f=[];let d=e;const p=()=>o.entries?o.entries():Object.entries(o),u=new Map(r);for(const[t]of p())u.delete(t);for(const t of u.values())t.remove();for(const[e,o]of p()){let l=r.get(e);if(r.delete(e),l!==d.nextSibling){l&&l.remove(),l=n.cloneNode(!0);const r=w(i,l);r[s]=e,r[c]=o,k(t,d,!1,l,f)}else{w(i,l)[c]=o}d=l,a.set(e,d)}F(f,t);for(const t of r.values())b(t),t.remove()};v(t,e,f,A(o)),f(t)})),n("*if",((t,e,n,o)=>{const s=T(o),c=$(e);let r=null;const l=t=>{if(s.call(t,c)){if(!r){const o=[];r=n.cloneNode(!0),k(t,e,!1,r,o),F(o,t)}}else r&&(b(r),r.remove(),r=null)};v(t,e,l,A(o)),l(t)})),n("*repeat",((t,e,n,o)=>{let s="index";const c=o.match(/^(\S+)\s+as\s+(\S+)$/);c&&(o=c[1],s=c[2]);const r=T(o),l=$(e);let i=[];const a=t=>{let o=+r.call(t,l);const c=[];for(;i.length>o;){const t=i.pop();b(t),t.remove()}let a=i.length+1,f=i[a-1]||e;for(;i.length<o;){let e=n.cloneNode(!0);w(l,e)[s]=a++,k(t,f,!1,e,c),i.push(e),f=e}F(c,t)};v(t,e,a,A(o)),a(t)})),t.Attr=()=>function(t,e){R(t,(t=>{C(t,l.get(t),"init",(t=>_(t,e)))}))},t.Component=(t,e)=>n=>{U(t,e,n)},t.CustomElement=B,t.Prop=()=>function(t,e){R(t,(t=>{C(t,l.get(t),"init",(t=>W(t,e)))}))},t.addDirective=n,t.attr=_,t.component=U,t.emit=(t,e,n,o={})=>{const s=l.get(t);s&&s.dispatchEvent(new CustomEvent(e,Object.assign({bubbles:!0,cancelable:!1,composed:!0,detail:n},o)))},t.findBindings=A,t.metadataControllerElement=l,t.metadataControllerRoot=f,t.parseText=j,t.prop=W,t.update=(t,e)=>{if(t)g(`set:${e||""}`,t);else for(const t of l.keys())g("set:",t)}}));